#!/bin/sh

set -e

BUN_VERSION="1.1.18"

echo "-----> Installing Bun $BUN_VERSION"

# Download and install bun
curl -fsSL https://bun.sh/install | bash -s -- bun-v$BUN_VERSION

# Ensure the installation path is correct
export BUN_INSTALL="$HOME/.bun"
export PATH=$BUN_INSTALL/bin:$PATH

# Log installation details
echo "Bun installed to: $BUN_INSTALL"
echo "PATH after installation: $PATH"
ls -l $BUN_INSTALL/bin

# Make sure bun is executable
chmod +x $BUN_INSTALL/bin/bun

# Create a .profile.d script to set PATH
mkdir -p $BUILD_DIR/.profile.d
echo 'export BUN_INSTALL="$HOME/.bun"' > $BUILD_DIR/.profile.d/bun.sh
echo 'export PATH="$BUN_INSTALL/bin:$PATH"' >> $BUILD_DIR/.profile.d/bun.sh

# Ensure the profile script is executable
chmod +x $BUILD_DIR/.profile.d/bun.sh
